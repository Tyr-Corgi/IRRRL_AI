@using static IRRRL.Web.Pages.Veteran.Apply

<div class="row">
    <!-- Left Column: Veteran & Property Info -->
    <div class="col-lg-8">
        <!-- Personal Information -->
        <div class="card mb-3">
            <div class="card-header">
                <h5 class="mb-0"><span class="oi oi-person"></span> Personal Information</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="text-muted small">Full Name</label>
                        <div class="fw-bold">@Application.FirstName @Application.LastName</div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="text-muted small">Date of Birth</label>
                        <div class="fw-bold">@Application.DateOfBirth?.ToString("MM/dd/yyyy")</div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="text-muted small">SSN</label>
                        <div class="fw-bold">***-**-@Application.SSN?.Substring(Application.SSN.Length - 4)</div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="text-muted small">Phone Number</label>
                        <div class="fw-bold">@Application.PhoneNumber</div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="text-muted small">Email</label>
                        <div class="fw-bold">@Application.Email</div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="text-muted small">Citizenship</label>
                        <div class="fw-bold">@GetCitizenshipDisplay(Application.CitizenshipStatus)</div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="text-muted small">Marital Status</label>
                        <div class="fw-bold">@Application.MaritalStatus</div>
                        @if (Application.MaritalStatus == "Married" && !string.IsNullOrEmpty(Application.SpouseFirstName))
                        {
                            <div class="text-muted small mt-1">Spouse: @Application.SpouseFirstName @Application.SpouseLastName</div>
                        }
                    </div>
                </div>
            </div>
        </div>

        <!-- Current Address -->
        <div class="card mb-3">
            <div class="card-header">
                <h5 class="mb-0"><span class="oi oi-home"></span> Current Address</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-12 mb-2">
                        <label class="text-muted small">Street Address</label>
                        <div class="fw-bold">@Application.CurrentStreetAddress</div>
                        <div class="fw-bold">@Application.CurrentCity, @Application.CurrentState @Application.CurrentZipCode</div>
                    </div>
                    <div class="col-md-6 mb-2">
                        <label class="text-muted small">Time at Address</label>
                        <div>@Application.YearsAtCurrentAddress years, @Application.MonthsAtCurrentAddress months</div>
                    </div>
                    <div class="col-md-6 mb-2">
                        <label class="text-muted small">Housing Status</label>
                        <div>@Application.CurrentHousingStatus</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Military Service -->
        <div class="card mb-3">
            <div class="card-header">
                <h5 class="mb-0"><span class="oi oi-star"></span> Military Service</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 mb-2">
                        <label class="text-muted small">Branch</label>
                        <div class="fw-bold">@Application.MilitaryBranch</div>
                    </div>
                    <div class="col-md-6 mb-2">
                        <label class="text-muted small">Status</label>
                        <div class="fw-bold">@Application.MilitaryStatus</div>
                    </div>
                    <div class="col-md-6 mb-2">
                        <label class="text-muted small">Service Dates</label>
                        <div>@Application.MilitaryServiceStartDate?.ToString("MM/yyyy") - @Application.MilitaryServiceEndDate?.ToString("MM/yyyy")</div>
                    </div>
                    <div class="col-md-6 mb-2">
                        <label class="text-muted small">VA Disability Rating</label>
                        <div>@(!string.IsNullOrEmpty(Application.VADisabilityRating) ? Application.VADisabilityRating : "None")</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Property Information -->
        <div class="card mb-3">
            <div class="card-header">
                <h5 class="mb-0"><span class="oi oi-home"></span> Property Information</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-12 mb-2">
                        <label class="text-muted small">Property Address</label>
                        <div class="fw-bold">@Application.PropertyAddress</div>
                        <div class="fw-bold">@Application.City, @Application.State @Application.ZipCode</div>
                    </div>
                    <div class="col-md-4 mb-2">
                        <label class="text-muted small">Property Type</label>
                        <div>@Application.PropertyType</div>
                    </div>
                    <div class="col-md-4 mb-2">
                        <label class="text-muted small">Occupancy</label>
                        <div>@Application.Occupancy</div>
                    </div>
                    <div class="col-md-4 mb-2">
                        <label class="text-muted small">Estimated Value</label>
                        <div class="fw-bold">@(Application.EstimatedHomeValue > 0 ? $"${Application.EstimatedHomeValue:N0}" : "Not provided")</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Declarations -->
        <div class="card mb-3">
            <div class="card-header">
                <h5 class="mb-0"><span class="oi oi-list"></span> Declarations</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4 mb-2">
                        <label class="text-muted small">Intends to Occupy</label>
                        <div>
                            @if (Application.IntendToOccupyProperty)
                            {
                                <span class="badge bg-success">Yes</span>
                            }
                            else
                            {
                                <span class="badge bg-warning text-dark">No - Was Primary</span>
                            }
                        </div>
                    </div>
                    <div class="col-md-4 mb-2">
                        <label class="text-muted small">Bankruptcy (7 yrs)</label>
                        <div>
                            @if (Application.HasBankruptcy)
                            {
                                <span class="badge bg-danger">Yes - @Application.BankruptcyType</span>
                            }
                            else
                            {
                                <span class="badge bg-success">No</span>
                            }
                        </div>
                    </div>
                    <div class="col-md-4 mb-2">
                        <label class="text-muted small">Foreclosure (7 yrs)</label>
                        <div>
                            @if (Application.HasForeclosure)
                            {
                                <span class="badge bg-danger">Yes</span>
                            }
                            else
                            {
                                <span class="badge bg-success">No</span>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Right Column: Loan Info & Quick Stats -->
    <div class="col-lg-4">
        <!-- Current Loan -->
        <div class="card mb-3 border-primary">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><span class="oi oi-dollar"></span> Current Loan</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label class="text-muted small">Loan Number</label>
                    <div class="fw-bold">@Application.LoanNumber</div>
                </div>
                <div class="mb-3">
                    <label class="text-muted small">Current Balance</label>
                    <div class="fs-4 fw-bold text-primary">$@Application.CurrentLoanAmount.ToString("N0")</div>
                </div>
                <div class="mb-3">
                    <label class="text-muted small">Interest Rate</label>
                    <div class="fs-5 fw-bold">@Application.CurrentInterestRate.ToString("0.000")%</div>
                </div>
                <div class="mb-3">
                    <label class="text-muted small">Monthly Payment</label>
                    <div class="fs-5 fw-bold">$@Application.CurrentMonthlyPayment.ToString("N2")</div>
                </div>
                <div class="mb-3">
                    <label class="text-muted small">Remaining Term</label>
                    <div>@Application.RemainingTermMonths months (@(Application.RemainingTermMonths / 12.0):F1 years)</div>
                </div>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="card mb-3 bg-light">
            <div class="card-header">
                <h6 class="mb-0"><span class="oi oi-graph"></span> Refinance Potential</h6>
            </div>
            <div class="card-body">
                <div class="mb-2">
                    <small class="text-muted">If refinanced at 3.5%:</small>
                    <div class="text-success fw-bold">
                        ~$@CalculatePotentialSavings(Application.CurrentLoanAmount, Application.CurrentInterestRate, 3.5m).ToString("N0")/month savings
                    </div>
                </div>
                <div class="mb-2">
                    <small class="text-muted">Current LTV (if home value accurate):</small>
                    <div class="fw-bold">
                        @(Application.EstimatedHomeValue > 0 ? $"{(Application.CurrentLoanAmount / Application.EstimatedHomeValue * 100):F1}%" : "N/A")
                    </div>
                </div>
                <div class="alert alert-info p-2 mt-3 mb-0">
                    <small><strong>ðŸ’¡ Tip:</strong> Use the NTB Calculator tab to verify Net Tangible Benefit and explore different rate scenarios.</small>
                </div>
            </div>
        </div>

        <!-- Contact Card -->
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0"><span class="oi oi-phone"></span> Quick Contact</h6>
            </div>
            <div class="card-body">
                <a href="tel:@Application.PhoneNumber" class="btn btn-outline-primary w-100 mb-2">
                    <span class="oi oi-phone"></span> Call Veteran
                </a>
                <a href="mailto:@Application.Email" class="btn btn-outline-secondary w-100">
                    <span class="oi oi-envelope-closed"></span> Send Email
                </a>
            </div>
        </div>
    </div>
</div>

@code {
    [Parameter]
    public ApplicationFormModel Application { get; set; } = new();

    private string GetCitizenshipDisplay(string status) => status switch
    {
        "USCitizen" => "U.S. Citizen",
        "PermanentResident" => "Permanent Resident Alien",
        "NonPermanentResident" => "Non-Permanent Resident Alien",
        _ => status
    };

    private decimal CalculatePotentialSavings(decimal loanAmount, decimal currentRate, decimal newRate)
    {
        // Simplified calculation for display purposes
        var currentPayment = loanAmount * (currentRate / 100 / 12);
        var newPayment = loanAmount * (newRate / 100 / 12);
        return currentPayment - newPayment;
    }
}

